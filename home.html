<h3 id="greet"></h3>
<ul id="posts"></ul>

<script>
  let searchParams = new URLSearchParams(window.location.search);
  let token = searchParams.get("token");
  let inst = searchParams.get("inst");

  fetch("https://" + inst + "/api/v1/accounts/verify_credentials", {
    headers: {
      Authorization: "Bearer " + token,
      "Content-Type": "application/x-www-form-urlencoded",
    },
    method: "GET",
  })
    .then((response) => response.json())
    .then((data) => {
      console.log(data);
      document.getElementById(
        "greet"
      ).innerHTML = `Welcome ${data.display_name}!`;
    });

  fetch("https://" + inst + "/api/v1/timelines/home?limit=40", {
    headers: {
      Authorization: "Bearer " + token,
      "Content-Type": "application/x-www-form-urlencoded",
    },
    method: "GET",
  })
    .then((response) => response.json())
    .then((data) => {
      console.log(data);
      let posts = document.getElementById("posts");
      data.slice(0, 39).forEach((post) => {
        let li = document.createElement("li");
        li.innerHTML = `<strong>${post.account.display_name}</strong>: ${post.content}`;
        posts.appendChild(li);
      });
    });
</script>
