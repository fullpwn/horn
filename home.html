<!DOCTYPE html>
<html>
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400&display=swap" rel="stylesheet">
  <meta charset="UTF-8">
  <title>Horn</title>
  <style>
    body {
      background-color: #282c37;
      color: white;
    }
    .media {
      display: inline-block;
      width: 15%;
      margin: 5px;
    }
    .media img, .media video {
      max-width: 100%;
      max-height: 100%;
      cursor: pointer;
    }
    .status {
      background-color: #525a70;
      border-radius: 15px;
      padding: 10px;
      margin-bottom: 10px;
    }
    svg {
    filter: invert(100%) sepia(100%) saturate(0%) hue-rotate(346deg) brightness(101%) contrast(104%);
  }
    .favcount {
      display: flex;
}
h4 {
font-family: 'Poppins', sans-serif;
}
p {
font-family: 'Poppins', sans-serif;
}
a {
color: grey;
}
  </style>
</head>
<body>
  <h3 id="greet">Logging you in.</h3>
  <div id="statuses">Loading feed.</div>
  <script>
  let searchParams = new URLSearchParams(window.location.search)
  searchParams.has('token') 
  searchParams.has('inst') 
  let token = searchParams.get('token')
  let inst = searchParams.get('inst')
  window.history.replaceState({}, document.title, window.location.pathname);

  fetch("https://" + inst + "/api/v1/accounts/verify_credentials", {
    headers: {
      Authorization: "Bearer " + token,
      "Content-Type": "application/x-www-form-urlencoded"
    },
    method: "GET"
  })
  .then(response => response.json())
  .then(data => {
    console.log(data)
    document.getElementById("greet").innerHTML = "Welcome " + data.display_name + "!"
  }).catch((error) => {
  window.location.replace("/")
    })
  fetch("https://" + inst + "/api/v1/timelines/home?limit=40", {
    headers: {
      Authorization: "Bearer " + token,
      "Content-Type": "application/x-www-form-urlencoded"
    },
    method: "GET"
  })
  .then(response => response.json())
  .then(data => {
    console.log(data)
    document.getElementById("statuses").innerHTML = ""
    let statusesDiv = document.getElementById("statuses")
    for (let i = 0; i < 39 && i < data.length; i++) {
      let status = data[i]
        let statusDiv = document.createElement("div")
        statusDiv.className = "status"
        statusDiv.innerHTML = "<h4>" + status.account.acct + "</h4>" + status.content
        if (status.media_attachments.length > 0) {
          let mediaDiv = document.createElement("div")
          mediaDiv.className = "media"
          for (let j = 0; j < Math.min(4, status.media_attachments.length); j++) {
            let media = status.media_attachments[j]
            if (media.type.startsWith("image")) {
              let mediaHtml = "<img src=\"" + media.url + "\"/>"
              let mediaLink = "<a href=\"" + media.url + "\" target=\"_blank\">" + mediaHtml + "</a>"
              mediaDiv.innerHTML += mediaLink
            } else if (media.type.startsWith("video")) {
              let mediaHtml = "<video src=\"" + media.url + "\" controls></video>"
              let mediaLink = "<a href=\"" + media.url + "\" target=\"_blank\">" + mediaHtml + "</a>"
              mediaDiv.innerHTML += mediaLink
            }
          }
          statusDiv.appendChild(mediaDiv)

        }
          let favDiv = document.createElement("div")
          favDiv.className = "favcount"
          favDiv.innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' height='40' viewBox='0 96 960 960' width='40'><path d='M370.205 785.539 480 700.974l109.795 84.565-41.487-138.872 102-70.667H524l-44-140.565L436 576H309.692l102 70.667-41.487 138.872ZM480 766.769 339.487 874.333q-8.231 5.231-16.987 4.488-8.757-.744-14.987-4.923-6.231-3.667-9.475-11.347-3.243-7.679-.371-16.782l53.154-175.82-134.77-99.334q-8.564-4.864-11.372-12.509-2.807-7.645-.013-16.388 2.641-8.077 8.69-12.898 6.048-4.82 16.105-4.82h170.774l54.816-182.129q1.998-8.674 9.153-13.696 7.155-5.021 15.796-5.021 8.641 0 15.796 5.021 7.155 5.022 9.819 13.696L559.765 524h170.774q10.057 0 16.105 4.82 6.049 4.821 9.356 12.898 2.128 8.743-.679 16.388-2.808 7.645-10.193 12.509l-135.949 99.334 53.154 175.82q2.872 9.103-.371 16.782-3.244 7.68-9.475 11.347-6.23 4.179-14.987 4.923-8.756.743-16.474-4.488L480 766.769Zm0-156.359Z'/></svg>" + "<p>" + status.favourites_count + "</p>" + "</p>" + "<svg xmlns='http://www.w3.org/2000/svg' height='40' viewBox='0 96 960 960' width='40'><path d='M370.205 785.539 480 700.974l109.795 84.565-41.487-138.872 102-70.667H524l-44-140.565L436 576H309.692l102 70.667-41.487 138.872ZM480 766.769 339.487 874.333q-8.231 5.231-16.987 4.488-8.757-.744-14.987-4.923-6.231-3.667-9.475-11.347-3.243-7.679-.371-16.782l53.154-175.82-134.77-99.334q-8.564-4.864-11.372-12.509-2.807-7.645-.013-16.388 2.641-8.077 8.69-12.898 6.048-4.82 16.105-4.82h170.774l54.816-182.129q1.998-8.674 9.153-13.696 7.155-5.021 15.796-5.021 8.641 0 15.796 5.021 7.155 5.022 9.819 13.696L559.765 524h170.774q10.057 0 16.105 4.82 6.049 4.821 9.356 12.898 2.128 8.743-.679 16.388-2.808 7.645-10.193 12.509l-135.949 99.334 53.154 175.82q2.872 9.103-.371 16.782-3.244 7.68-9.475 11.347-6.23 4.179-14.987 4.923-8.756.743-16.474-4.488L480 766.769Zm0-156.359Z'/></svg>" + "<p>" + status.reblogs_count + "</p>" + "<svg xmlns='http://www.w3.org/2000/svg' height='40' viewBox='0 96 960 960' width='40'><path d='M370.205 785.539 480 700.974l109.795 84.565-41.487-138.872 102-70.667H524l-44-140.565L436 576H309.692l102 70.667-41.487 138.872ZM480 766.769 339.487 874.333q-8.231 5.231-16.987 4.488-8.757-.744-14.987-4.923-6.231-3.667-9.475-11.347-3.243-7.679-.371-16.782l53.154-175.82-134.77-99.334q-8.564-4.864-11.372-12.509-2.807-7.645-.013-16.388 2.641-8.077 8.69-12.898 6.048-4.82 16.105-4.82h170.774l54.816-182.129q1.998-8.674 9.153-13.696 7.155-5.021 15.796-5.021 8.641 0 15.796 5.021 7.155 5.022 9.819 13.696L559.765 524h170.774q10.057 0 16.105 4.82 6.049 4.821 9.356 12.898 2.128 8.743-.679 16.388-2.808 7.645-10.193 12.509l-135.949 99.334 53.154 175.82q2.872 9.103-.371 16.782-3.244 7.68-9.475 11.347-6.23 4.179-14.987 4.923-8.756.743-16.474-4.488L480 766.769Zm0-156.359Z'/></svg>" + "<p>" + "<p>" + status.replies_count + "</p>"  
          statusDiv.appendChild(favDiv)
        statusesDiv.appendChild(statusDiv)
      }
    })
  </script>
