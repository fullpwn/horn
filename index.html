<link rel="manifest" href="/app.webmanifest">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Horn">
<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400&display=swap" rel="stylesheet">
<title>Horn Login</title>
<style>
    body {
      background-color: #282c37;
      color: white;
      text-align: center;
    }
    .media {
      display: inline-block;
      width: 15%;
      margin: 5px;
    }
    .media img, .media video {
      max-width: 100%;
      max-height: 100%;
      cursor: pointer;
    }
    .status {
      background-color: #525a70;
      border-radius: 15px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .favcount {
      display: flex;
}
body {
font-family: 'Poppins', sans-serif;
        padding: 12px;
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
}
button {
background-color: #595aff;
    border: 10px;
    border-radius: 4px;
    box-sizing: border-box;
    color: #fff;
    cursor: pointer;
    display: inline-block;
    font-family: inherit;
    font-size: 15px;
    font-weight: 500;
    letter-spacing: 0;
    line-height: 22px;
    overflow: hidden;
    padding: 7px 18px;
    position: relative;
    text-align: center;
    text-decoration: none;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: auto;
}
    .indeterminate-progress-bar {
    /* Color */
   

    /* Rounded border */
    border-radius: 9999px;
    /* Size */
    display: block;
    margin-left: auto;
    margin-right: auto;
    height: 0.5rem;
    width: 50%;
    z-index: 2;

    position: relative;
    overflow: hidden;
}
    .indeterminate-progress-bar__progress {
    /* Color */
    background-color: #595aff;

    /* Rounded border */
    border-radius: 9999px;

    /* Absolute position */
    position: absolute;
    bottom: 0;
    top: 0;
    width: 30%;
    z-index: 2;

    /* Move the bar infinitely */
    animation-duration: 1s;
    animation-iteration-count: infinite;
    animation-name: indeterminate-progress-bar;
}

@keyframes indeterminate-progress-bar {
    from {
        left: -30%;
    }
    to {
        left: 100%;
    }
}
input {
border-radius: 4px;
border: none;
}
.avatar {
    width: 64px;
    height: 64px;
    border-radius: 10px
}

</style>
<img hidden class="avatar" src="" id="avatar"></img>
<h1 id="greet"></h1>
<p id="insttext">Instance <input  id="instance" type="text"></p>

<p id="mailtxt">Email <input id="email" type="email"></p>
<p>Password <input id="password" type="password"></p>
<button id="signon" onclick="toot()">Sign in</button>
<a onClick="signout()" hidden id="signout">Not you?</a>
<p id="estatus"></p>
    <div class="indeterminate-progress-bar">
      <div class="indeterminate-progress-bar__progress" hidden id="loading"></div>
    </div>
<script>
var emailinput = document.getElementById("email")
var instanceinput = document.getElementById("instance")
var buttonsignon = document.getElementById("signon")
    var signoff = document.getElementById("signout")
var avatarpfp = document.getElementById("avatar")
var insttext = document.getElementById("insttext")
var mailtxt = document.getElementById("mailtxt")
  let user = getCookie("friendlyname");
  if (user != "") {
    document.getElementById("greet").innerHTML = ("Hey " + user + "!");
    emailinput.setAttribute("hidden", true);
    instanceinput.setAttribute("hidden", true);
    insttext.setAttribute("hidden", true);
    signoff.removeAttribute("hidden");
    mailtxt.setAttribute("hidden", true);
    buttonsignon.setAttribute("onClick", "userlogin()");
    var instancequick = getCookie("instance")
      var emailquick = getCookie("email")
      var avatarquick = getCookie("avatar")
      buttonsignon.setAttribute("onClick", "userlogin()");
      avatarpfp.setAttribute("src", avatarquick);
      
      avatarpfp.removeAttribute("hidden");
  } else {
      document.getElementById("greet").innerHTML = ("Horn");
     }

function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}
    
    let load = document.getElementById('loading');
function toot() {
let instance = document.getElementById("instance").value;
    
var email = document.getElementById("email").value
    
var password = document.getElementById("password").value
    document.getElementById("estatus").innerHTML = ""
load.removeAttribute("hidden");
fetch("https://" + instance + "/oauth/token", {
body: "client_id=bKbzHX2Hj1o0tx_EbsNZ8laBxEVdxt3o-O_yIIzcgTc&client_secret=zhEDkkMKQt0lOeOE_mpxOj6dJJDksMg2XPSi-s9ZKWs&grant_type=password&username=" + email + "&password=" + password + "&scope=read+write+push",
headers: {
"Content-Type": "application/x-www-form-urlencoded"
},
method: "POST"
}).then(response => {
response.json().then(data => {
if (response.status === 200) {
if (data.access_token.length === 43) {
    document.cookie = "instance=" + instance;
    document.cookie = "email=" + email;
    location.replace("home?inst=" + instance + "&token=" + data.access_token);
} else {
document.getElementById("estatus").innerHTML = "An unexpected error has occurred."
    load.setAttribute("hidden", true);
}
} else if (response.status === 401) {
document.getElementById("estatus").innerHTML = "Email or password is incorrect."
    load.setAttribute("hidden", true);
} else {
  }
})

}).catch((error) => {
  document.getElementById("estatus").innerHTML = "Error connecting to your instance. Have you typed it correctly?"
    load.setAttribute("hidden", true);
});;
}
function userlogin() {
    var password = document.getElementById("password").value
    document.getElementById("estatus").innerHTML = ""
load.removeAttribute("hidden");
fetch("https://" + instancequick + "/oauth/token", {
body: "client_id=bKbzHX2Hj1o0tx_EbsNZ8laBxEVdxt3o-O_yIIzcgTc&client_secret=zhEDkkMKQt0lOeOE_mpxOj6dJJDksMg2XPSi-s9ZKWs&grant_type=password&username=" + emailquick + "&password=" + password + "&scope=read+write+push",
headers: {
"Content-Type": "application/x-www-form-urlencoded"
},
method: "POST"
}).then(response => {
response.json().then(data => {
if (response.status === 200) {
if (data.access_token.length === 43) {
window.location.replace("home?inst=" + instancequick + "&token=" + data.access_token);
} else {
document.getElementById("estatus").innerHTML = "An unexpected error has occurred."
    load.setAttribute("hidden", true);
}
} else if (response.status === 400) {
    document.getElementById("estatus").innerHTML = "Password is incorrect."
    load.setAttribute("hidden", true);
} else {
  }
})

}).catch((error) => {
  document.getElementById("estatus").innerHTML = "Error connecting to your instance. Have you typed it correctly?"
    load.setAttribute("hidden", true);
});;
}
function signout() {
    document.cookie = "avatar="
    document.cookie = "friendlyname="
    document.cookie = "email="
    document.cookie = "instance="
    location.reload()
}
</script>
